{% extends "mobile_base.html" %}

{% block title %}MidWhereAh - Find Your Midpoint{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">

<!-- Additional CSS for transport mode selection -->
<style>
/* Transport Mode Selection Styles */
.transport-selector {
    display: flex;
    gap: 6px;
    justify-content: center;
    margin-top: 6px;
}

.transport-btn {
    background: #f0f0f0;
    border: 2px solid #ddd;
    border-radius: 20px;
    padding: 6px 10px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 32px;
}

.transport-btn:hover {
    background: #e0e0e0;
    border-color: #bbb;
}

.transport-btn.active {
    background: #8B5DB8;
    border-color: #8B5DB8;
    color: white;
}

.location-container {
    margin-bottom: 12px;
}

.location-item {
    background: #f8f8f8;
    border-radius: 24px;
    padding: 10px 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.location-item:focus-within {
    box-shadow: 0 0 0 2px #8B5DB8;
    background: white;
}
</style>
{% endblock %}

{% block content %}
<!-- Full-screen map -->
<div id="map"></div>

<!-- Fixed Location Input Header (NON-SCROLLABLE) -->
<div class="location-input-card">
  <div class="app-header">
    <div class="app-logo">
      <i class="fas fa-map-marker-alt"></i>
      <span>MidWhereAh</span>
    </div>
    <!-- Hamburger menu REMOVED as requested -->
  </div>
  
  <!-- Location inputs container - exactly two inputs with transport mode selection -->
  <div class="locations-container">
    <!-- Location 1 with transport mode selector -->
    <div class="location-container">
      <div class="location-item">
        <div class="d-flex align-items-center">
          <div class="location-icon purple">
            <i class="fas fa-circle"></i>
          </div>
          <input type="text" id="location-1" class="location-input" placeholder="Enter first location">
        </div>
      </div>
      <div class="transport-selector">
        <button class="transport-btn active" data-mode="TRANSIT" data-person="1" title="Public Transport">
          ðŸš‡
        </button>
        <button class="transport-btn" data-mode="DRIVING" data-person="1" title="Car/Taxi">
          ðŸš—
        </button>
        <button class="transport-btn" data-mode="WALKING" data-person="1" title="Walking">
          ðŸš¶
        </button>
      </div>
    </div>
    
    <!-- Location 2 with transport mode selector -->
    <div class="location-container">
      <div class="location-item">
        <div class="d-flex align-items-center">
          <div class="location-icon purple">
            <i class="fas fa-circle"></i>
          </div>
          <input type="text" id="location-2" class="location-input" placeholder="Enter second location">
        </div>
      </div>
      <div class="transport-selector">
        <button class="transport-btn active" data-mode="TRANSIT" data-person="2" title="Public Transport">
          ðŸš‡
        </button>
        <button class="transport-btn" data-mode="DRIVING" data-person="2" title="Car/Taxi">
          ðŸš—
        </button>
        <button class="transport-btn" data-mode="WALKING" data-person="2" title="Walking">
          ðŸš¶
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Purple Arrow Floating Button (Shows after two locations are input) -->
<div class="find-central-btn" id="find-central-btn">
  <i class="fas fa-location-arrow"></i>
</div>

<!-- Bottom Navigation -->
<div class="bottom-navigation">
  <div class="nav-item active" data-page="home">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </div>
  <div class="nav-item" data-page="compass">
    <i class="fas fa-compass"></i>
    <span>Explore</span>
  </div>
  <div class="nav-item nav-item-center" data-page="create">
    <div class="center-fab">
      <i class="fas fa-plus"></i>
    </div>
  </div>
  <div class="nav-item" data-page="groups">
    <i class="fas fa-users"></i>
    <span>Groups</span>
  </div>
  <div class="nav-item" data-page="profile">
    <i class="fas fa-user"></i>
    <span>Profile</span>
  </div>
</div>

<!-- Slide-out Menu (Keep but no hamburger trigger) -->
<div class="slide-menu" id="slide-menu">
  <div class="menu-header">
    <div class="user-info">
      <div class="user-avatar">TA</div>
      <div class="user-details">
        <h3>Thiha Aung Set</h3>
        <p>Signed in</p>
      </div>
    </div>
    <button class="menu-close" id="menu-close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="menu-items">
    <a href="/dashboard" class="menu-item">
      <i class="fas fa-users"></i>
      <span>My Groups</span>
    </a>
    <a href="/settings" class="menu-item">
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </a>
    <a href="#" class="menu-item" id="logout-menu">
      <i class="fas fa-sign-out-alt"></i>
      <span>Logout</span>
    </a>
  </div>
</div>
<div class="menu-overlay" id="menu-overlay"></div>

<!-- NO VENUE CARDS - Removed completely as requested -->

{% endblock %}

{% block scripts %}
<!-- Load mobile.js and maps.js first -->
<script src="{{ url_for('static', filename='js/maps.js') }}"></script>
<script src="{{ url_for('static', filename='js/mobile.js') }}"></script>

<!-- Load Google Maps API following official best practices -->
<script>
  // Make sure initMap is accessible globally
  window.initMap = initMap;
  
  // Add debugging to check map container
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Map container:', document.getElementById('map'));
    console.log('Map container dimensions:', 
      document.getElementById('map').offsetWidth, 
      document.getElementById('map').offsetHeight);
  });
  
  // Load the Google Maps JavaScript API
  (g=>{
    var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;
    b=b[c]||(b[c]={});
    var d=b.maps||(b.maps={});
    r=new Set,e=new URLSearchParams;
    u=()=>h||(h=new Promise(async(f,n)=>{
      await (a=m.createElement("script"));
      e.set("libraries",[...r]+"");
      for(k in g)e.set(k.replace(/[A-Z]/g,t=>"-"+t[0].toLowerCase()),g[k]);
      e.set("callback",c+".maps."+q);
      a.src=`https://maps.googleapis.com/maps/api/js?`+e;
      d[q]=f;
      a.onerror=()=>h=n(Error(p+" could not load."));
      a.nonce=m.querySelector("script[nonce]")?.nonce||"";
      m.head.append(a);
    }));
    d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n));
  })({key: "{{ google_maps_api_key }}"});
  
  // Add a fallback to ensure map initialization
  window.addEventListener('load', function() {
    setTimeout(function() {
      if (!window.midwhereahMap) {
        console.log('Map not initialized after timeout, trying again...');
        if (typeof initMap === 'function') {
          initMap();
        }
      }
    }, 1000);
  });
</script>
{% endblock %}