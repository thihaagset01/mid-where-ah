{% extends "mobile_base.html" %}

{% block title %}MidWhereAh - Find Your Midpoint{% endblock %}

{% block head %}
{{ super() }}
<!-- NO CONFLICTING CSS - Using only the clean CSS from mobile.css -->
{% endblock %}

{% block content %}
<!-- Full-screen map -->
<div id="map"></div>

<!-- Fixed Location Input Header -->
<div class="group-header-container">
  <div class="group-logo">
    <a href="/">
        <img src="static/images/logo.png" alt="Logo" />
    </a>
  </div>
  <div class="group-text">
    <span>Mid-Where-Ah</span>
  </div>
</div>

<!-- FIXED: Compact location inputs container -->
<div class="group group-col center" id="locations-container">
  <!-- Location 1 - NEW STRUCTURE -->
  <div class="location-container" data-person-id="1">
      <div class="location-item">
          <!-- Transport icon replaces colored dot -->
          <div class="transport-icon transit" 
               data-person="1" 
               data-current-mode="TRANSIT"
               data-tooltip="Public Transport">
              ðŸš‡
          </div>
          
          <input type="text" 
                 id="location-1" 
                 class="location-input" 
                 placeholder="Enter first location" 
                 autocomplete="off">
                 
          <button class="remove-person-btn" style="display: none;" title="Remove Person">
              <i class="fas fa-times"></i>
          </button>
      </div>
      <!-- REMOVE the transport-selector div entirely -->
  </div>
    
  <!-- Location 2 - NEW STRUCTURE -->
  <div class="location-container" data-person-id="2">
      <div class="location-item">
          <!-- Transport icon replaces colored dot -->
          <div class="transport-icon transit" 
               data-person="2" 
               data-current-mode="TRANSIT"
               data-tooltip="Public Transport">
              ðŸš‡
          </div>
          
          <input type="text" 
                 id="location-2" 
                 class="location-input" 
                 placeholder="Enter second location" 
                 autocomplete="off">
                 
          <button class="remove-person-btn" style="display: none;" title="Remove Person">
              <i class="fas fa-times"></i>
          </button>
      </div>
      <!-- REMOVE the transport-selector div entirely -->
  </div>

  <!-- Add Person Button (keep as is) -->
  <div class="add-person-container">
      <button id="add-person-btn">
          <i class="fas fa-plus"></i>Add Person
      </button>
      <div class="person-count-display">
          <span id="person-count">2</span> people
      </div>
  </div>
</div>

<!-- Find Central Button -->
<div class="find-central-btn" id="find-central-btn">
  <i class="fas fa-location-arrow"></i>
</div>

<!-- Bottom Navigation -->
<div class="bottom-container">
  <div class="bottom-navigation">
    <div class="nav-item active" data-page="home">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </div>
    <div class="nav-item" data-page="compass">
      <i class="fas fa-compass"></i>
      <span>Explore</span>
    </div>
    <div class="nav-item nav-item-center" data-page="create">
      <div class="center-fab">
        <i class="fas fa-plus"></i>
      </div>
    </div>
    <div class="nav-item" data-page="groups">
      <i class="fas fa-users"></i>
      <span>Groups</span>
    </div>
    <div class="nav-item" data-page="profile">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </div>
  </div>
  
  <!-- Create popup -->
  <div class="nav-create-popup hidden" id="dropdown-menu">
    <div class="pop-icon pop1">
      <i class="fas fa-user"></i>
    </div>
    <div class="pop-icon pop2">
      <i class="fa-regular fa-calendar-plus"></i>
    </div>
    <div class="pop-icon pop3">
      <i class="fa-regular fa-circle-up"></i>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Load JavaScript -->
<script src="{{ url_for('static', filename='js/maps.js') }}"></script>
<script src="{{ url_for('static', filename='js/mobile.js') }}"></script>

<!-- Google Maps API -->
<script>
  window.initMap = initMap;
  
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Map container:', document.getElementById('map'));
    console.log('Map container dimensions:', 
      document.getElementById('map').offsetWidth, 
      document.getElementById('map').offsetHeight);
      
    if (window.hybridLocationManager) {
      console.log('Initializing hybrid location manager...');
      window.hybridLocationManager.initialize();
    }
  });
  
  // Load Google Maps API
  (g=>{
    var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;
    b=b[c]||(b[c]={});
    var d=b.maps||(b.maps={});
    r=new Set,e=new URLSearchParams;
    u=()=>h||(h=new Promise(async(f,n)=>{
      await (a=m.createElement("script"));
      e.set("libraries",[...r]+"");
      for(k in g)e.set(k.replace(/[A-Z]/g,t=>"-"+t[0].toLowerCase()),g[k]);
      e.set("callback",c+".maps."+q);
      a.src=`https://maps.googleapis.com/maps/api/js?`+e;
      d[q]=f;
      a.onerror=()=>h=n(Error(p+" could not load."));
      a.nonce=m.querySelector("script[nonce]")?.nonce||"";
      m.head.append(a);
    }));
    d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n));
  })({key: "{{ google_maps_api_key }}"});
  
  window.addEventListener('load', function() {
    setTimeout(function() {
      if (!window.midwhereahMap) {
        console.log('Map not initialized after timeout, trying again...');
        if (typeof initMap === 'function') {
          initMap();
        }
      }
    }, 1000);
  });
</script>
{% endblock %}