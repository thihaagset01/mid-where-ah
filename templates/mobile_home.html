{% extends "mobile_base.html" %}

{% block title %}MidWhereAh - Find Your Midpoint{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
<style>
    /* Style for the location input to make it look like a button */
    .location-input {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 1rem;
        width: 100%;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        cursor: pointer;
        text-align: left;
    }
    
    .location-input::placeholder {
        color: #999;
    }
    
    .location-input:focus {
        outline: none;
        border-color: #8B5DB8;
        box-shadow: 0 0 0 2px rgba(139, 93, 184, 0.2);
    }
    
    /* Prevent the input from being focused on page load */
    .location-input:not(:focus) {
        background: #f8f9fa;
    }
    
    .location-container {
        position: relative;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Full-screen map -->
<div id="map"></div>

<!-- Locations Container -->
<div class="locations-container" id="locations-container">
  <!-- Location 1 -->
  <div class="location-container" data-person-id="1">
      <div class="transport-icon transit" 
           data-person="1" 
           data-current-mode="TRANSIT"
           data-tooltip="Public Transport">
          <i class="fas fa-subway"></i>
      </div>
      <input type="text" 
             id="location-1" 
             class="location-input" 
             placeholder="Enter first location" 
             autocomplete="off"
             readonly>
  </div>
    
  <!-- Location 2 -->
  <div class="location-container" data-person-id="2">
      <div class="transport-icon transit" 
           data-person="2" 
           data-current-mode="TRANSIT"
           data-tooltip="Public Transport">
          <i class="fas fa-subway"></i>
      </div>
      <input type="text" 
             id="location-2" 
             class="location-input" 
             placeholder="Enter second location" 
             autocomplete="off"
             readonly>
  </div>

  <div style="display: flex; align-items: center; justify-content: space-between;" id="parent-container">
    <!-- Add Person Container -->
    <div class="add-person-container">
      <button id="add-person-btn" class="add-person-circle">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <!-- Find Central Button -->
    <div class="find-central-btn" id="find-central-btn">
        <i class="fas fa-location-arrow"></i>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Services -->
<script src="{{ url_for('static', filename='js/homepage-integration.js') }}"></script>
<script src="{{ url_for('static', filename='js/homepage-collapsible.js') }}"></script>
<script src="{{ url_for('static', filename='js/autofill.js') }}"></script>

<!-- SINGLE Google Maps API Load -->
<script>
  // Global function to initialize maps
  window.initMapWhenReady = function() { 
    console.log('Google Maps API loaded successfully');
    
    // Prevent multiple initializations
    if (window.mapsApiLoaded) {
      console.log('Maps already loaded, skipping...');
      return;
    }
    window.mapsApiLoaded = true;
    
    if (typeof initMap === 'function') {
      initMap();
    } else {
      console.error('initMap function not found');
    }
  };
  
  // Load Google Maps API only if not already loaded
  function loadGoogleMapsAPI() {
    if (window.google && window.google.maps) {
      console.log('Google Maps already loaded');
      window.initMapWhenReady();
      return;
    }
    
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initMapWhenReady&loading=async`;
    script.async = true;
    script.defer = true;
    script.onerror = function() {
      console.error('Failed to load Google Maps API');
    };
    document.head.appendChild(script);
  }

  // Load when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    loadGoogleMapsAPI();
    
    // Initialize the autofill after a short delay to ensure DOM is ready
    setTimeout(() => {
      if (window.stylizedAutofill) {
        // Re-initialize the autofill to ensure it picks up the new inputs
        window.stylizedAutofill = new StylizedAutofill();
      }
    }, 500);
  });
</script>
{% endblock %}