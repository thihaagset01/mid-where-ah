<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.svg') }}" type="image/svg+xml">
    <title>MidWhereAh - {% block title %}Find the perfect meetup spot{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/venue-cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
    
    <!-- PWA manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    
    <!-- Mobile and iOS meta tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="MidWhereAh">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon-192x192.png') }}">
    
    <style>
    /* Mobile-specific styles - scoped to prevent affecting desktop */
    html, body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        overflow: hidden; /* Prevent scrolling */
        height: 100vh;
        color: #343A40;
    }

    #map {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 1;
        background-color: #f0f0f0;
    }

    /* Fixed header - non-scrollable */
    .location-input-card {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-radius: 0 0 20px 20px;
        padding: 12px 16px;
        max-height: 180px;
        overflow: visible;
    }

    .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
    }

    .app-logo {
        display: flex;
        align-items: center;
        font-size: 18px;
        font-weight: 600;
        color: #8B5DB8;
    }

    .app-logo i {
        margin-right: 8px;
        font-size: 20px;
    }

    .locations-container {
        margin-top: 16px;
    }

    .location-item {
        display: flex;
        align-items: center;
        background: #f8f8f8;
        border-radius: 24px;
        padding: 10px 16px;
        margin-bottom: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .location-item:focus-within {
        box-shadow: 0 0 0 2px #8B5DB8;
        background: white;
    }

    .location-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 24px;
        height: 24px;
        margin-right: 8px;
    }

    .location-icon.purple i {
        color: #8B5DB8;
        font-size: 12px;
    }

    .location-input {
        border: none;
        background: none;
        flex: 1;
        font-size: 16px;
        outline: none;
        padding: 8px;
    }

    /* Purple arrow button - initially hidden */
    .find-central-btn {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: #8B5CF6;
        border: none;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        cursor: pointer;
        z-index: 999;
        transition: all 0.3s ease;
    }

    .find-central-btn.active {
        display: flex !important;
    }

    .find-central-btn.used {
        background: #28a745 !important;
        transform: scale(1.1);
    }

    /* Bottom navigation */
    .bottom-navigation {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: white;
        border-top: 1px solid #E9ECEF;
        display: flex;
        justify-content: space-around;
        padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px 12px;
        cursor: pointer;
        color: #6C757D;
        font-size: 12px;
        transition: color 0.2s;
    }

    .nav-item.active {
        color: #8B5DB8;
    }

    .nav-item i {
        font-size: 20px;
        margin-bottom: 4px;
    }

    .nav-item-center {
        position: relative;
    }

    .center-fab {
        background: #8B5DB8;
        color: white;
        width: 48px;
        height: 48px;
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(139, 93, 184, 0.3);
        margin-bottom: -8px;
    }

    /* Slide Menu */
    .slide-menu {
        position: fixed;
        top: 0;
        left: -300px;
        width: 280px;
        height: 100%;
        background: white;
        z-index: 20;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .slide-menu.open {
        left: 0;
    }

    .menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 15;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
    }

    .menu-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .menu-header {
        padding: 24px 20px;
        border-bottom: 1px solid #E9ECEF;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .user-info {
        display: flex;
        align-items: center;
    }

    .user-avatar {
        width: 48px;
        height: 48px;
        border-radius: 24px;
        background: #8B5DB8;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 12px;
    }

    .user-details h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }

    .user-details p {
        margin: 4px 0 0;
        font-size: 14px;
        color: #6C757D;
    }

    .menu-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6C757D;
        cursor: pointer;
    }

    .menu-items {
        margin-top: 12px;
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        color: #495057;
        text-decoration: none;
        border-bottom: 1px solid #F8F9FA;
    }

    .menu-item i {
        margin-right: 16px;
        width: 20px;
        font-size: 18px;
        color: #8B5DB8;
    }
    </style>
    
    {% block head %}{% endblock %}
</head>
<body>
    <!-- Mobile content - full screen -->
    {% block content %}{% endblock %}

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration injected from server
        window.firebaseConfig = JSON.parse('{{ firebase_config | tojson | safe }}');
        // Initialize Firebase when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initFirebase === 'function') {
                initFirebase();
            }
        });
    </script>
    
    <!-- Firebase Initialization -->
    <script src="{{ url_for('static', filename='js/firebase-config.js') }}"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>