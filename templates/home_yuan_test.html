{% extends "mobile_base.html" %}

{% block title %}MidWhereAh - Find Your Midpoint{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/view_map.css') }}">

{% endblock %}

{% block content %}
<div id="modal-overlay" class="hidden"></div>

<!-- 1. Full-screen map -->
<div id="map"></div>

<!-- 2. Top header bar -->
<div class="group group-row center" style="width: 90%; max-width: 600px; margin-top: 20px;">
  <a href="/groups" class="header-nav-button back-btn">
    <img src="static/images/Back Button.svg">
  </a>
  <img src="static/images/group-bar-placeholder.png" class="center-img">
  <button class="header-nav-button filter-btn">
    <img src="static/images/Filter Icon.svg">
  </button>
</div>

<!-- 3. The Modal Content -->
<div id="activities-modal" class="hidden">
  <!-- Modal Header -->
  <div class="modal-header">
    <h2>Select Activities</h2>
    <button id="modal-close-btn" class="close-button">Ã—</button>
  </div>
  <!-- Modal Grid -->
  <div class="activity-grid">
    <button class="activity-item"><img src="static/images/food-icon.svg" alt="Food & Cafes"><span>Food &
        Cafes</span></button>
    <button class="activity-item"><img src="static/images/entertainment-icon.svg"
        alt="Entertainment"><span>Entertainment</span></button>
    <button class="activity-item"><img src="static/images/wellness-icon.svg"
        alt="Wellness"><span>Wellness</span></button>
    <button class="activity-item"><img src="static/images/cultural-icon.svg"
        alt="Cultural"><span>Cultural</span></button>
  </div>
</div>

{% endblock %}



{% block scripts %}
<!-- Load mobile.js and maps.js first -->
<script src="{{ url_for('static', filename='js/mobile.js') }}"></script>
<script src="{{ url_for('static', filename='js/modal.js') }}"></script> <!-- ADD THIS LINE -->

<!-- Load Google Maps API following official best practices -->
 <!--
<script>
  // Make sure initMap is accessible globally
  window.initMap = initMap;
  
  // Add debugging to check map container
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Map container:', document.getElementById('map'));
    console.log('Map container dimensions:', 
      document.getElementById('map').offsetWidth, 
      document.getElementById('map').offsetHeight);
  });
  
  // Load the Google Maps JavaScript API
  (g=>{
    var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;
    b=b[c]||(b[c]={});
    var d=b.maps||(b.maps={});
    r=new Set,e=new URLSearchParams;
    u=()=>h||(h=new Promise(async(f,n)=>{
      await (a=m.createElement("script"));
      e.set("libraries",[...r]+"");
      for(k in g)e.set(k.replace(/[A-Z]/g,t=>"-"+t[0].toLowerCase()),g[k]);
      e.set("callback",c+".maps."+q);
      a.src=`https://maps.googleapis.com/maps/api/js?`+e;
      d[q]=f;
      a.onerror=()=>h=n(Error(p+" could not load."));
      a.nonce=m.querySelector("script[nonce]")?.nonce||"";
      m.head.append(a);
    }));
    d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n));
  })({key: "{{ google_maps_api_key }}"});
  
  // Add a fallback to ensure map initialization
  window.addEventListener('load', function() {
    setTimeout(function() {
      if (!window.midwhereahMap) {
        console.log('Map not initialized after timeout, trying again...');
        if (typeof initMap === 'function') {
          initMap();
        }
      }
    }, 1000);
  });
</script>
-->
{% endblock %}