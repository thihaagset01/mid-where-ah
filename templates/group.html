{% extends "mobile_base.html" %}

{% block title %}MidWhereAh - Find Your Midpoint{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">

<div class="group-header-container">
  <div class="group-logo">
    <a href="/">
        <img src="static/images/logo.png" alt="Logo" style="cursor: pointer;" />
    </a>
  </div>
  <div class="group-text">
    <span>Mid-Where-Ah</span>
  </div>
</div>
<div class="group-col bottom-container center">
  <!-- Bottom Navigation -->
  <div class="bottom-navigation">
    <div class="nav-item" data-page="home">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </div>
    <div class="nav-item" data-page="compass">    
      <i class="fas fa-compass"></i>
      <span>Explore</span>
    </div>
    <div class="nav-item nav-item-center" data-page="create">
      <div class="center-fab">
        <i class="fas fa-plus"></i>
      </div>
    </div>
    <div class="nav-item active" data-page="groups">
      <i class="fas fa-users"></i>
      <span>Groups</span>
    </div>
    <div class="nav-item" data-page="profile">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </div>
  </div>
  </div>

<!-- Bento grid for groups -->
<div class="group groupbg group-col" style="align-items: center;">
  <div class="group-text">
    <span style = "font-size:50px;">Groups</span>
  </div>
  <div class="search-bar-container">
      <input type="text" class="search-input" placeholder="Search...">
      <button class="search-button">üîç</button>
  </div>
  <div class="bento-grid">
    <a href="/group_chat" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 1</span>
    </a>
    <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 2</span>
    </a>
    <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 3</span>
    </a>
        <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 4</span>
    </a>
        <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 5</span>
    </a>
        <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 6</span>
    </a>
        <a href="/" class="bento-item">
      <img src="static/images/group-placeholder.png" class="group-icon">
      <span style = "color: white;">Group 7</span>
    </a>
  </div>
</div>

{% endblock %}

{% block scripts %}
<!-- Load mobile.js and maps.js first -->
<script src="{{ url_for('static', filename='js/maps.js') }}"></script>
<script src="{{ url_for('static', filename='js/group.js') }}"></script>

<!-- Load Google Maps API following official best practices -->
<script>
  // Make sure initMap is accessible globally
  window.initMap = initMap;
  
  // Add debugging to check map container
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Map container:', document.getElementById('map'));
    console.log('Map container dimensions:', 
      document.getElementById('map').offsetWidth, 
      document.getElementById('map').offsetHeight);
  });
  
  // Load the Google Maps JavaScript API
  (g=>{
    var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;
    b=b[c]||(b[c]={});
    var d=b.maps||(b.maps={});
    r=new Set,e=new URLSearchParams;
    u=()=>h||(h=new Promise(async(f,n)=>{
      await (a=m.createElement("script"));
      e.set("libraries",[...r]+"");
      for(k in g)e.set(k.replace(/[A-Z]/g,t=>"-"+t[0].toLowerCase()),g[k]);
      e.set("callback",c+".maps."+q);
      a.src=`https://maps.googleapis.com/maps/api/js?`+e;
      d[q]=f;
      a.onerror=()=>h=n(Error(p+" could not load."));
      a.nonce=m.querySelector("script[nonce]")?.nonce||"";
      m.head.append(a);
    }));
    d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n));
  })({key: "{{ google_maps_api_key }}"});
  
  // Add a fallback to ensure map initialization
  window.addEventListener('load', function() {
    setTimeout(function() {
      if (!window.midwhereahMap) {
        console.log('Map not initialized after timeout, trying again...');
        if (typeof initMap === 'function') {
          initMap();
        }
      }
    }, 1000);
  });
</script>
{% endblock %}